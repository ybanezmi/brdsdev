/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   3.0.1
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;kvExpandRow=function(e){"use strict";!function(t){var a=e.gridId,n=e.hiddenFromExport,o=e.detailUrl,l=e.onDetailLoaded,d=e.batchToggle,i=e.expandIcon,s=e.collapseIcon,r=e.expandTitle,c=e.collapseTitle,v=e.expandAllTitle,p=e.collapseAllTitle,k=e.enableRowClick,u=e.enableCache,f=e.extraData,x=n?e.rowCssClass+" skip-export":e.rowCssClass,w=e.animationDuration,g=t("#"+a),h=g.find(".kv-expand-header-cell"),m=h.find(".kv-expand-header-icon"),C=void 0===e.collapseAll?!1:e.collapseAll,R=void 0===e.expandAll?!1:e.expandAll,N=g.find("td .kv-expand-row:not(.kv-state-disabled)"),A=N.length,b="kv-expand-detail-loading",T=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},y=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},D=function(e,t){e.removeClass(t).addClass(t)},E=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},I=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},F=function(e){D(e,b)},L=function(e){var t=isNaN(w)?1e3:w+200;setTimeout(function(){e.removeClass(b)},t)};return 0===f.length&&(f={}),0===N.length?void D(h,"kv-state-disabled"):(N.each(function(){var e,a,n=t(this),v=n.find(".kv-expand-icon"),p=n.closest("tr"),N=n.closest(".kv-expand-icon-cell"),D=n.find(".kv-expand-detail"),U=n.find(".kv-expanded-row"),j=U.data("key"),K=U.data("index"),Q=p.find("td:visible").length;if(!T(v)&&!y(v))return!0;0===U.length&&(j=p.data("key"),e=p.next('tr.kv-expand-detail-row[data-key="'+j+'"]'),U=e.find(".kv-expanded-row"));var q=function(e){var a=t.extend({expandRowKey:j,expandRowInd:K},f),n=u?0===U.html().length:!0;return F(N),o.length>0&&n?(g.trigger("kvexprow.beforeLoad",[K,j,f]),void U.load(o,a,function(){L(N),l&&t.isFunction(l)&&l(),e(),g.trigger("kvexprow.loaded",[K,j,f])})):(L(N),void e())},z=function(e){g.find('tr[data-index="'+K+'"]').remove(),U.hide(),p.after(U);var t='<tr class="kv-expand-detail-row '+x+'" data-key="'+j+'" data-index="'+K+'">';U.wrap('<td colspan="'+Q+'">').parent().wrap(t),v.html(s),N.attr("title",c),e?U.slideDown(w,function(){I(v)}):(U.show(),I(v)),0===o.length&&L(N)},B=function(){F(N),D.html(""),v.html(i),N.attr("title",r),a=U.closest(".kv-expand-detail-row"),U.slideUp(w,function(){U.unwrap().unwrap(),U.appendTo(D),E(v)}),L(N)},G=function(){return N.hasClass(b)?void 0:y(v)?(q(function(){z(!0)}),g.trigger("kvexprow.toggle",[K,j,f,!0]),void v.focus()):void(T(v)&&(B(),g.trigger("kvexprow.toggle",[K,j,f,!1]),v.focus()))};return R&&d?(y(v)&&q(function(){z(!0),kvRowNum++,kvRowNum>=A&&(L(h),m.focus())}),kvRowNum>=A&&(L(h),m.focus()),!0):C&&d?(T(v)&&(B(),kvRowNum++,kvRowNum>=A&&(L(h),m.focus())),kvRowNum>=A&&(L(h),m.focus()),!0):(T(v)&&z(!1),N.off("click").on("click",function(){G(N)}),void p.off("click").on("click",function(){k&&G(N)}))}),void(d&&h.off().on("click",function(){if(!h.hasClass(b)&&0!==N.length){var a=y(m),n=T(m),o=t.extend({},e,{expandAll:n,collapseAll:a});F(h),n?(kvRowNum=N.find(".kv-state-collapsed").length,E(m),m.html(s),h.attr("title",p),g.trigger("kvexprow.toggleAll",[f,!1])):a&&(kvRowNum=N.find(".kv-state-expanded").length,I(m),m.html(i),h.attr("title",v),g.trigger("kvexprow.toggleAll",[f,!0])),kvExpandRow(o)}})))}(window.jQuery)};